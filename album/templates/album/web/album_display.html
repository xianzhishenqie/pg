{% extends './base.html' %}

{% load i18n %}
{% load staticfiles %}
{% load static_v %}

{% block title %}
    我的相册
{% endblock %}


{% block top_css %}
    {{ block.super }}
    <link type="text/css" rel="stylesheet" href="{% static 'base/common/lib/animate/animate.css' %}">
    <link type="text/css" rel="stylesheet" href="{% static 'base/common/lib/magic/magic.css' %}">
    <link type="text/css" rel="stylesheet" href="{% static_v 'base/common/css/animation.css' %}">
{% endblock %}

{% block local_css %}
    <style type="text/css">
        #vueMask {
            left: 0;
            right: 0;
        }
        #albumDisplay .music {
            right: 20px;
            top: 20px;
            z-index: 201;
        }
        #albumDisplay .mask {
            left: 0;
            right: 0;
            z-index: 200;
        }
        #album{
            display: none;
        }
    </style>
{% endblock %}

{% block container %}
<div class="w-100 h-100" id="albumDisplay">
    <div class="position-absolute w-100 h-100" id="vueMask">
        <div class="music position-absolute">
            <img class="music-icon"
                 src="{% static 'album/web/img/music.png' %}"
                 :class="{'animated infinite spin': music.active}"
                 @click="toggleMusic">
            <audio :src="album.music_data.url || album.music_data.file" autoplay="autoplay" loop="loop" v-if="album.music_data.id"></audio>
        </div>
        <v-touch class="mask w-100 h-100 position-absolute d-none" v-on:panleft="editAlbum"></v-touch>
    </div>

    {% include './album_templates/k_july.html' %}
</div>
    {% include './components/album_edit.html' %}
{% endblock %}

{% block bottom_js %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'base/common/lib/anime/anime.min.js' %}"></script>
{% endblock %}
{% block local_js %}
<script type="text/javascript">
    $.extend(context, {
        pk: {{ pk }},
        canHideEditor: true,
        albumDetailApiUrl: '{% url "album:web:api:album-detail" pk %}',
        hideEdit: function (isChanged) {
            if (isChanged) {
                window.location.reload();
            }
        }
    });
</script>
<script type="text/javascript">
var adVue = new Vue({
    el: '#vueMask',
    data: {
        music: {
            active: true,
        },
        album: {
            name: '',
            desc: '',
            picture_list: [],
            music_data: {
                id: '',
                name: '',
                file: '',
                url: '',
            },
            template_data: {
                id: '',
                name: '',
                cover: '',
                cover_url: '',
            },
        },
    },
    methods: {
        toggleMusic: function(){
            this.music.active = !this.music.active;
            var audio = $(this.$el).find('audio')[0];
            if (this.music.active) {
                audio.play();
            } else {
                audio.pause();
            }
        },
        getAlbum: function () {
            var vue = this;
            http.get(context.albumDetailApiUrl, {}, function(res){
                vue.album = res;

            });
        },
        editAlbum: function () {
            aVue.show();
        },
    },
    mounted: function () {
        var vue = this;

        vue.getAlbum();
    }

});
</script>
{% endblock %}